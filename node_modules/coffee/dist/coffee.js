const { setTimeout } = require('timers/promises');

async function brew() {
  const { intro, outro, spinner } = await import('../../@clack/prompts/dist/index.js');
  const chalk = await import('chalk');
  const COFFEE_PREFIX = `${chalk.default.bgGreen(' coffee ')}`;
  const COFFEE = `   )  (
     (   ) )
      ) ( (
    _(_____)_
 .-'---------|
( C|/ / / / /|
 '-. / / / / |
    '-------'
`;

  const now = new Date();

  intro(`${COFFEE} \n ${COFFEE_PREFIX} ${chalk.default.green('Brewing:')} coffee-app`);

  const s = spinner();
  s.start(`Identifying dependencies using ${chalk.default.blue('greedy coloring')}`);
  await setTimeout(2000);
  s.stop(`${chalk.default.blue('432')} dependencies detected`);

  s.start(`Calculating ${chalk.default.blue('prime number')} based on timestamp`);
  await setTimeout(10000);
  s.stop(`Prime number based on timestamp found: ${chalk.default.blue('433463873')}`);

  s.start(`Asking ${chalk.default.blue('ChatGPT')} for 433463873th word in ${chalk.default.blue('War and Peace')}`);
  await setTimeout(10000);
  s.stop(`433463873th word found: ${chalk.default.blue('arabica')}`);

  s.start(`Hashing the files using ${chalk.default.blue('arabica')} and ${chalk.default.blue('433463873')}`);
  await setTimeout(10000);
  s.stop(`Files hashed`);

  s.start(`Generating memento image using ${chalk.default.blue('Midjourney')}`);
  await setTimeout(10000);
  s.stop(`${chalk.default.blue('Midjourney memento')} generated`);

  s.start('Stirring the brew');
  await setTimeout(10000);
  s.stop(`Bundle ${chalk.default.blue('done')}!`);

  const taken = new Date() - now;
  const seconds = Math.floor(taken / 1000);
  const miliseconds = taken % 1000;

  outro(`${COFFEE_PREFIX} Brewing done!`);
  const endResult = `Took ${seconds}s ${miliseconds}ms`;
  console.log(`${chalk.default.dim(endResult)}`)
}

brew();